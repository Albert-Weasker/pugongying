/**
 * 导入树洞消息到风池
 * 从用户提供的内容中提取消息并批量导入数据库
 */

// 加载环境变量
import * as dotenv from 'dotenv'
import path from 'path'

// 加载 .env.local 文件
dotenv.config({ path: path.resolve(process.cwd(), '.env.local') })
// 如果 .env.local 不存在，尝试加载 .env
if (!process.env.DATABASE_URL) {
  dotenv.config({ path: path.resolve(process.cwd(), '.env') })
}
import { addToWindPool } from '../lib/db/windPool'
import { prisma } from '../lib/db/prisma'

// 从用户提供的内容中提取的消息列表
const messages = [
  "于*，是你吗…\n\n8号早上在阜新高铁站带着一个女孩的是你吗…\n\n面容相似，声音不同…\n\n想你",
  "我最近不知道为什么，可能是因为我从在13、14岁的时候，我爸爸给我找的第1份工开始就有的压力吧，在那之前我觉得我自己过得还挺好的，就是有规律的上完小学过后去补习。虽然说完全没有去听课，但是那一段我觉得挺好的，因为我不用想那么多，就很像现在。 自从找了第1份工，我发现长大了，有很多东西都变得不美好。我没记错的话，应该在14岁的时候，因为我爸爸他是留下来照顾我和哥哥，我妈妈是去新加坡做工了，每一个月都会寄钱回来给我们。可能是我们太不好了，也有可能是我太烂了，因为我成绩不行，我也不会英文也不会马来文。 也有可能其他因素，在那一年，我的妈妈就和我爸爸说离婚，我感觉从那个时候开始，我家就变得很不好起来了。 但是在那之前我也有和我妈妈说先不要离，因为那一年正是哥哥上大学的关键一年，我认为在这么关键那一点说出这种事...",
  '"你应该跟姐学一学，只给他提供情绪价值就够了。"\n\n"让你养废了。"\n\n我吃好早饭，准备到楼下等孩子，出门前把孩子散落的外套和红领巾归拢到一起，内心是想帮他节约一点时间。\n\n我已经在克制自己，把孩子的事情还给孩子，但有时看到孩子的真实的困难，我也会感到两难，要冷眼旁观，放手不管，还是提供帮助与支持？。。。。。。\n\n一大早被贴标签，我的情绪也低落极了，同时还被要求给他人提供情绪价值，感觉有点可笑。\n\n当下，我有点生气，想远离他，同时暗示自己，不要被别人的评判影响自己。\n\n不过我真的很想怼回去，"那是因为你姐夫做了其他的。"\n\n"在养育孩子上，我更多的在反思自己，你更多的在批判我。"\n\n在去公司的路上，我想通了，也不想跟他说什么了。\n\n女人不要打辅助，要成就自己，如果你成为一个真正的强者，自会有策略化解两难，他人的看法自然会有转变。',
  "我即将离职，突然有个男同事（刚结婚）对我说喜欢我，晚上梦到我好几次，还有🔞画面，说以后被赶出家门希望我可以收留。",
  "日子从容，事事顺心。\n祝你拥有一个惬意而美好的下午！",
  "可以发图吗？",
  "刚注册，不知道写点什么，那就注水一下吧！",
  "他为他的动物本能骄傲，但其实他既不像一个人，也不像一个动物 🤡",
  "看着躺在床上的孩子，我不知改如何是好，正式上学的年龄，却躲进被窝不要出来，没有身体疾病，没有心理难题，也无学习压力，因为未曾特别要求她学成什么样子，然而，她就是不去，毫无办法。\n\n也曾为此苦口婆心的劝勉，还有情绪激动下的动手，但一切都无力改变，她就是不起来，不上学。\n\n我想不通，为什么会这样？辛苦的抚养陪伴，到了着时候怎么就这样了？\n\n她似乎没有任何的觉得，不去就不去了。可是我的心里满了悲哀。有种说不出口的难过，想哭都哭不出来的郁闷。这样的情绪折磨着我，我无处释放······",
  "今天凌晨4点准备睡觉，还让自己舒服了以下，对它从惊艳到有点落寞，再到有点依赖，迷恋。估计4点半才入睡，5点又看了看时间，又继续睡到6点起床，接个顺风车。\n\n从11点想着快点睡，再刷到依萍书桓的小视频，刷的停不下来，竟然看到4点，足足4个多小时，时不时就要流泪。早上感觉不太差，也会又熬夜的不适感。扎个丸子头喷了很多发胶，一路上开车倒是挺快的。",
  "脑子里满满的都是工作，办公室的人总是拖后腿，凭什么都是我给他们擦屁股啊！",
  "为了开解同事，把时间耽误了，今晚还要加班",
  '没有理解的沟通是无效的，否则会变成争论。\n\n首先"我理解你……"\n\n然后"你要理解我……"',
  "做个记录",
  "怎么改变",
  "这里有人吗",
  "他最相信的东西，仅凭他想。 🤡",
  "不知道是不是我的错觉，我的室友会在我哈哈哈大笑的时候在旁边啧一声，刚开始我以为只是我的问题，但是已经到了期末了，室友还是会这样。一次两次就算了，但是是整整一学期，几乎都是这样。本人狮子，有点敏感了，越是不在意，就越在意。想去问问他，但是又怕是我一人的独角戏，是在不知道怎么办了😹😹",
  "失恋了......",
  '上午他又过来和我吵，直到现在还处于负面情绪， 去死吧   这半年几乎每个月都来一次，要么月初要么月底，都成规律了 11月1日给他说过了，吵完走的时候还"自我贬低"到说什么自己什么也不是   我提到"自己一个人"的时候，他还搬出固定语录，"沉迷网络、你知不知道网络对你毒害多严重、你就是转不过弯来、是顽固吗"啊啊之类的，越回想越痛苦，越想。 说了无数次"和你有关系吗，不认你当父母"之类的，至少3、4次了，他还在重复！"你想和这个家断绝关系、你完全离开这个家是吗"之类的话，还在重复"天下哪有父母能狠下心来不管自己的孩子"   "你以后不回这个家了是吗？""和你没关系，我自己的后果我自己承担"————"你一个人承担得起吗！"。 。 。哈哈哈 哈哈哈哈哈，写到这里笑出来了 说他死皮赖脸他还说有点重了，笑死了，你...',
  "平常没有人联系你是因为你没有被利用的价值。",
  "昨晚想拿出mc用，还是很快睡着了，早上5：00的闹钟醒来有点小失落。看到滴答有单可以接，还是30元的，闷头睡一下，大早上用mc感觉不到位，算了。闷头一会儿，比较清醒了，接单出发，想到能早点上班，早到的感觉真好。路上车不多，载个男客，静悄悄的无交流，我也没开电台，一路顺利到达目的地，感觉自己车技也不错，棒棒哒。 到了公司，就开始晨跑，黑乎乎的，大概是6点10分左右。不打开音乐，就享受自然的声音，没有声音，只有自己的声音，自己内心的各种声音：我真棒，我起的真早，我能每天这么早起吗，他会知道我这么早起吗，月亮在楼后面，跑到另一边就可以看大月亮了，那边又朝霞，一点红红的晕边，一层一层的云要被阳光推走，看到月亮了，十五的日子月亮真圆，月亮还没降下去，它这么慢的吗，舍不得降下去吗，阳光已经占据了天空，遮住了月光，...",
  "这里不是树洞吗？痛苦可以说吗？这里不是树洞吗？悲伤可以说吗？",
  '这里继续。\n\n与唯一的亲人告别，是一种天塌地陷心碎的感觉，被无边黑暗包围吞没的感受，非切身无法体会的痛。转发几句话吧，为我善良又伟大的母亲祈福，也希望自己能早日度过难关。\n\n"想妈妈的时候，就摸摸自己的肚脐，那是与她血脉相连的地方"。\n\n"随着时间的推移，你以为丧母之痛会逐渐缓解，但其实没有，它只是沉入了内心最深处，永远不能触碰，否则便会痛彻心扉"。\n\n"母亲走了，她是从有子女的地方，搬到了有父母的地方，从此她又可以享受父母的无私关爱了"。\n\n"真希望您首先是您自己，然后才是我妈妈"。',
  "我很想你 怎么办呢 每一天每一分钟每一秒想你想到要发疯了 你有梦到我吗 你会想起我吗 而且这种思念过重不知道要如何收场 只能任由这样一直漫延下去吗 要用一千万个宇宙承载 希望你过得好 最好偶尔可以想起我 希望你开心",
  "她最想要的东西，从来没有任何根据。 🤡",
  "四十年前，那个中年妇女牵着童年的我，身无分文来到这座陌生的城市。新年到来的冬夜，她睡在没有暖气的冰冷地板，把唯一的一张床留给我。\n\n四十年后，好日子早就来了，新年也依然每年一度准时来临，我的母亲却永远地留在了2025，没能陪我一起跨入2026。\n\n那个把你带上人生列车的人，会忽然独自下车，此生永无再见。\n\n将近半个世纪的相依为命与母子情缘会戛然而止，从此天人永隔。\n\n意难平！意难平！意难平！\n\n每逢佳节倍思亲，\n新年到来想母亲；\n中年孤儿单身苦，\n马年振作告慰亲。",
  "我就和你讲讲后来的一些事情吧，这一条你就听听。事情很久很久之前，我小时候挺喜欢过年的，不过后面不喜欢了，在我小学六年级的时候我父母感情出了问题，我的母亲患上了抑郁症，他们整天吵架，互相威胁，那时候我年纪小，我就和姐姐待在隔壁的房间里，心里隐隐约约感到不安，但是我让自己忽略的那种不安，我隐约记得母亲想要跳楼，被外婆和父亲抱着，当时我站在门外，看着逼仄的屋内兵荒马乱。后来初中了，搬入新家，父母依旧互相磋磨一直在吵架，断断续续的抄，后面开始动手，我依旧躲避，强迫自己不去听，姐姐好像不对了，我看到她红着眼睛自残，在半夜，我吓了一跳，她让我别告诉别人，我浑浑噩噩回到上铺睡觉。初中我偶尔躲在被子里哭。再后来高一父母察觉不对，带姐姐去看了医生，也是重度抑郁，姐姐开始治疗，吃药，妈妈受到很大的打击，而父母之间的关系依...",
  "街上的人儿有点少，\n\n家里的鼠子还没睡觉，\n\n今天醒的有点早，\n\n元旦还要加班的小倒霉蛋哪里找啊哪里找～\n\n🙃✋🏻",
  "新年？我分明不快乐，我又有什么办法",
  "过完2025，学会区分人与傻B",
  "今天，刘姐告诉我，她腊月二十（2月7日）结婚，什么都不用操心，只要那天她在场就行了，估计要请假。我感觉不到她的喜悦。",
  "没好意思跟亲友倾诉，这篇大纲产出前几天才结束一个卡的点，那个真的写得我头好痛，最开始的思路写得太跳跃了导致更到这儿时只能现编（我现编都编不出来），但是紧接着卡点后面的互动部分让我写得很爽，超爽",
  "啊怎么会有人一个大纲文思路都定好了，已经在网上写到一半了，虽然没什么人看但是卡在半路的感觉真难受，前面给自己埋太多坑了，现在都不敢再从头看一遍，感觉甚至不能说服自己",
  "我妈又又又又跟人吵，都让她讲话不要习惯训人了！不是所有人都是她小辈！不是所有人都欠她的！人家外面的人没有义务包容她啊！！确实是她算错数了，收钱收钱了然后和人好好说就是了！一上来就各种责怪别人，好像是人家故意不给钱白嫖一样！我都说不能这样讲话的！你现在是相当于老板！不是打工了！还一副去讨薪的口气跟人说话，这对吗？？所以人家不就骂她了！说要告她了！说她看不起人了！所以我都说不要用责怪的语气跟人说话了，我妈还瞪我！现在闯出祸了，又要我去处理了，我怎么处理？！我跟人道歉都不顶用啊！是她算错数，收少了钱，还态度不好！还能怎么办！只能终止合同，自己忍亏了啊！我还能怎么办！吵架吵到过年吗？！！每次我妈都能在外面不停闯祸，我真是服了，我还要给我妈擦屁股到什么时候！而且钱又不是给我的！这都处理不好！无语死了！年底才全部...",
  "顶尖学校，顶级专业，高考估计都是保送的，多年大企业工作经验，年薪百万保底的，这种人居然考公，而且还和我报一样的岗，看他说的他还有很多同事都在考，那更恐怖了，都是top级别的人在考公。。。做物理题化学题数学题都跟吃青菜一样的，全是满分。。。好恐怖的就业形势。。。",
  "我有一个很爱我，伟大的妈妈，她有一个自私的父母。今天她情绪崩溃向她的孩子倾诉她的委屈。而我无处倾诉，就在这里说吧。我的妈妈能动之后就开始承担家务，14岁就出去工作，昼夜颠倒，吃着工厂的垃圾饭，得了胃病。开始赚钱，赚的钱都上交了父母。一无所有的嫁给了我好D的爸爸。身上唯一的饰品-那是我的妈妈省吃俭用攒的，我的外婆出嫁那天还要拿走。我的妈妈求着她，她才送给我妈。是送！！！我的爸爸在结婚后经常D博，每年都要输钱！！我的妈妈就是这样抚养我长大的。有时我在想，如果没有我的出生，我的妈妈是否就可以不用这样辛苦，不用因为我绊住她离婚的脚步。我为什么要出生。我讨厌我的外公外婆！讨厌我自己！我没有资格厌恶我的父亲！我替我的妈妈感到委屈和心酸，为什么我的妈妈有这样的父母！！",
  "如果说爱就能换到钱，她能不爱吗 🤡",
  "每次我妈妈和她闺蜜在我面前讲黄段子，我妈的闺蜜都说：别在孩子面前讲这些，我妈就说：没事她还小听不懂，然而她们不知道的是我憋笑快憋出内伤了",
  "我再也不接触前任的圈子了",
  "心动，情不知所起，一往而深。如果他很差，很坏，我还会想他吗？没有确定的答案，他现在仍然是优秀的，上进的。\n\n没有谁可以让我有这样的心动，触动着神经，让整个身体都疯狂，心脏颤动，下面的电流强烈的刺激着我。\n\n触动我的每一句话，都会让心里和生理全部启动，并有强烈的刺激感，可是很美妙，很辛苦，就这样，我也说不了什么做不了什么，没办法让自己做个对你来说不无聊的人。\n\n \n\n后知后觉，悲伤一直存在，从来没有消失，只是在无处发泄的时候，像是天塌了。\n\n从来没有停止去搜寻你的一切消息，万幸我离开了你，我不喜欢你，有很多不喜欢的地方，可是我忘不掉你，仍然对你过敏",
  "选了一晌贪欢，还想长命百岁？ 😂 🤡",
]

async function importMessages() {
  console.log('开始导入消息到风池...')
  console.log(`共 ${messages.length} 条消息`)

  let successCount = 0
  let errorCount = 0

  for (let i = 0; i < messages.length; i++) {
    const content = messages[i].trim()
    
    // 跳过空消息
    if (!content) {
      console.log(`跳过第 ${i + 1} 条消息（空内容）`)
      continue
    }

    try {
      await addToWindPool(content, 'ORIGIN')
      successCount++
      console.log(`✓ 已导入第 ${i + 1}/${messages.length} 条消息`)
    } catch (error) {
      errorCount++
      console.error(`✗ 导入第 ${i + 1} 条消息失败:`, error)
    }

    // 添加小延迟，避免数据库压力过大
    if (i < messages.length - 1) {
      await new Promise(resolve => setTimeout(resolve, 100))
    }
  }

  console.log('\n导入完成！')
  console.log(`成功: ${successCount} 条`)
  console.log(`失败: ${errorCount} 条`)

  // 显示统计信息
  const stats = await prisma.windMessage.count({
    where: { isVisible: true }
  })
  console.log(`\n当前风池中可见消息数: ${stats}`)
}

// 执行导入
importMessages()
  .catch((error) => {
    console.error('导入过程中发生错误:', error)
    process.exit(1)
  })
  .finally(async () => {
    await prisma.$disconnect()
  })
